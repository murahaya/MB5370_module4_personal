---
title: "Workshop3"
author: "Hayato Murai"
date: "`r Sys.Date()`"
output: html_document
---
usethis::use_git

#Data Wrangling in TidyR
```{r}

install.packages("tidyverse")
library(tidyverse)

```
#Tidy data sets have three interrelated rules. 
1 Each variable must have its own column.
2 Each observation must have its own row.
3 Each value must have its own cell.

#Pipe 
A pipe is really only designed to help you better understand what the code is doing. It takes the data (left of the pipe) and applies the function (right of pipe). In todays workshop we’ll use both %>%, and |>  which achieve the exact same thing (|> is brand new in base R, %>% only works in tidyr and magrittr packages)

```{r}
# Compute rate per 10,000
table1 %>% 
  mutate(rate = cases / population * 10000)
#> # A tibble: 6 × 5
#>   country      year  cases population  rate
#>   <chr>       <int>  <int>      <int> <dbl>
#> 1 Afghanistan  1999    745   19987071 0.373
#> 2 Afghanistan  2000   2666   20595360 1.29 
#> 3 Brazil       1999  37737  172006362 2.19 
#> 4 Brazil       2000  80488  174504898 5.61 
#> 5 China        1999 212258 1272915272 1.67 
#> 6 China        2000 213766 1280428583 1.67

```
#Pivoting Data

Pivoting longer
Increasing the number of rows and decreasing the number of columns 


```{r}
billboard |> 
  pivot_longer(
    cols = starts_with("wk"), 
    names_to = "week", 
    values_to = "rank",
    values_drop_na = TRUE
  )
#> # A tibble: 24,092 × 5
#>    artist track                   date.entered week   rank
#>    <chr>  <chr>                   <date>       <chr> <dbl>
#>  1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87
#>  2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2      82
#>  3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3      72
#>  4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4      77
#>  5 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk5      87
#>  6 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk6      94
#>  #> # ℹ 24,082 more rows

```

As you can see in the above code snippet, there are three key arguments to the pivot_longer() function:
cols which specifies the columns you want to pivot (the ones that aren’t variables). Note: you could either use !c(artist, track, date.entered) OR starts_with('wk') because the cols argument uses the same syntax as select().
names_to which names the variable stored in the column names. We chose to name that variable week.
values_to which names the variable stored in the cell values that we named rank

```{r}
df <- tribble(
  ~id,  ~bp1, ~bp2,
   "A",  100,  120,
   "B",  140,  115,
   "C",  120,  125
)
```

Need data set to have 3 variables 

ID = (A, B, C)
Measurement = (bp1 or bp2)
Value = (cell values)

```{r}
df |> 
  pivot_longer(
    cols = bp1:bp2,
    names_to = "measurement",
    values_to = "value"
  )

```
#Widening Datasets
Taking a long data set and condensing it down into more columns 

```{r}
df <- tribble(
  ~id, ~measurement, ~value,
  "A",        "bp1",    100,
  "B",        "bp1",    140,
  "B",        "bp2",    115, 
  "A",        "bp2",    120,
  "A",        "bp3",    105
)
```

Opposite function of lengthening data sets

```{r}
df |> 
  pivot_wider(
    names_from = measurement,
    values_from = value
  )
```
One NA value because patient B did not have a 3rd value in the first dataset


```{r}

stocks <- tibble(
  year   = c(2015, 2015, 2016, 2016),
  half  = c(   1,    2,     1,    2),
  return = c(1.88, 0.59, 0.92, 0.17)
)
stocks

stocks %>% 
  pivot_wider(names_from = year, values_from = return) %>% 
  pivot_longer(`2015`:`2016`, names_to = "year", values_to = "return")

```
Above operation converted the year values into character values since the data types are lost when doing a pivot wider 

#Separating and uniting values in columns 

```{r}
table3 %>% 
  separate(rate, into = c("cases", "population"), sep = "/") %>%
  unite("rate", cases, population, sep = "/") 
```




